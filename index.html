<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PersonaHire Ultimate - ä¸“ä¸šAIé¢è¯•å¹³å°</title>
    <meta name="description" content="åŸºäºGPT-4.1å’ŒElevenLabs TTSçš„AIé¢è¯•å®˜å¹³å°ï¼Œæä¾›ä¸“ä¸šçš„é¢è¯•æ¨¡æ‹Ÿä½“éªŒ">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fafbfc;
            color: #1a1a1a;
            line-height: 1.6;
        }

        /* å¤´éƒ¨ */
        .header {
            background: #fff;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2563eb;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f0f9ff;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid #e0f2fe;
            color: #0369a1;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        .title-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .main-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1a1a1a;
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        .mode-indicator {
            display: inline-block;
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        /* APIé…ç½®é¢æ¿ */
        .api-setup {
            background: #f8fafc;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid #dee2e6;
            display: none;
        }

        .api-setup h3 {
            color: #2563eb;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .api-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .api-setup input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: #fff;
            font-size: 0.9rem;
            color: #374151;
            transition: all 0.2s ease;
        }

        .api-setup input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .api-setup button {
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .api-setup button:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        /* ä¸»å¡ç‰‡ */
        .main-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel {
            background: #f8fafc;
            padding: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1.5rem;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .setting-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #374151;
        }

        .setting-select {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: #fff;
            font-size: 0.9rem;
            color: #374151;
            transition: all 0.2s ease;
        }

        .setting-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-section {
            padding: 2rem;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: #fafbfc;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .message {
            margin-bottom: 1.5rem;
            max-width: 80%;
        }

        .message.ai {
            margin-right: auto;
        }

        .message.user {
            margin-left: auto;
        }

        .message-header {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .message.ai .message-header {
            color: #2563eb;
        }

        .message.user .message-header {
            color: #059669;
            justify-content: flex-end;
        }

        .message-content {
            background: #fff;
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .message.ai .message-content {
            border-left: 3px solid #2563eb;
        }

        .message.user .message-content {
            border-right: 3px solid #059669;
            background: #f0fdf4;
        }

        .voice-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.8rem;
        }

        .voice-btn {
            background: #ff4081;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .voice-btn:hover {
            background: #e91e63;
            transform: scale(1.05);
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .input-textarea {
            flex: 1;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .input-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .send-button {
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .send-button:hover:not(:disabled) {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .send-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            background: #fff;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover:not(:disabled) {
            background: #f9fafb;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .control-btn.primary {
            background: #2563eb;
            color: #fff;
            border-color: #2563eb;
        }

        .control-btn.primary:hover:not(:disabled) {
            background: #1d4ed8;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
            display: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .audio-indicator {
            display: none;
            color: #ff4081;
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* çŠ¶æ€æ¶ˆæ¯ */
        .status-message {
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        /* åº•éƒ¨é“¾æ¥ */
        .footer-links {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem 0;
            border-top: 1px solid #e5e7eb;
        }

        .footer-links a {
            color: #6b7280;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 0 1rem;
            transition: color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .footer-links a:hover {
            color: #2563eb;
        }

        .footer-separator {
            color: #d1d5db;
            margin: 0 0.5rem;
        }

        /* è°ƒè¯•ä¿¡æ¯ */
        .debug-info {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #6b7280;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-info.show {
            display: block;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .main-title {
                font-size: 2rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .api-row {
                grid-template-columns: 1fr;
            }

            .input-section {
                flex-direction: column;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .control-btn {
                width: 100%;
                max-width: 300px;
            }

            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }

            .footer-links a {
                display: block;
                margin: 0.5rem 0;
            }

            .footer-separator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header class="header">
        <div class="header-content">
            <div class="logo">PersonaHire Ultimate</div>
            <div class="header-status" id="headerStatus">
                <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                GPT-4.1 + ElevenLabs TTS
            </div>
        </div>
    </header>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <section class="title-section">
            <div class="mode-indicator" id="modeIndicator">
                âœ¨ å³å¼€å³ç”¨ç‰ˆ - é›¶é…ç½®å¯åŠ¨
            </div>
            <h1 class="main-title">AIé¢è¯•å®˜å¹³å°</h1>
            <p class="subtitle">
                ä¸“ä¸šçš„äººå·¥æ™ºèƒ½é¢è¯•æ¨¡æ‹Ÿç³»ç»Ÿï¼Œå¸®åŠ©æ‚¨æå‡é¢è¯•è¡¨ç°ï¼Œ
                é‡‡ç”¨æœ€å…ˆè¿›çš„GPT-4.1æ¨ç†å¼•æ“å’ŒElevenLabsè¯­éŸ³åˆæˆæŠ€æœ¯ã€‚
            </p>
        </section>

        <!-- APIé…ç½®é¢æ¿ -->
        <div class="api-setup" id="apiSetup">
            <h3>ğŸ”‘ APIé…ç½® (å¼€å‘è€…æ¨¡å¼)</h3>
            <div class="api-row">
                <input type="password" id="openaiKey" placeholder="OpenAI API Key (sk-...)">
                <input type="password" id="elevenKey" placeholder="ElevenLabs API Key (å¯é€‰)">
            </div>
            <button onclick="saveApiKeys()">ä¿å­˜é…ç½®</button>
            <small style="color: #6b7280; display: block; margin-top: 1rem;">
                ğŸ’¡ åªæœ‰OpenAI Keyæ˜¯å¿…éœ€çš„ã€‚ElevenLabs Keyå¯è·å¾—æ›´å¥½çš„è¯­éŸ³ä½“éªŒ
            </small>
        </div>

        <!-- çŠ¶æ€æ¶ˆæ¯ -->
        <div class="status-message" id="statusMessage"></div>

        <!-- ä¸»å¡ç‰‡ -->
        <div class="main-card">
            <!-- è®¾ç½®é¢æ¿ -->
            <div class="settings-panel">
                <h3 class="settings-title">é¢è¯•è®¾ç½®</h3>
                <div class="settings-grid">
                    <div class="setting-group">
                        <label class="setting-label">é¢è¯•å®˜é£æ ¼</label>
                        <select class="setting-select" id="interviewerStyle">
                            <option value="friendly">å‹å¥½é¼“åŠ±å‹</option>
                            <option value="professional">ä¸“ä¸šä¸¥è°¨å‹</option>
                            <option value="pressure">å‹åŠ›æµ‹è¯•å‹</option>
                            <option value="creative">åˆ›æ„å¼€æ”¾å‹</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">é¢è¯•éš¾åº¦</label>
                        <select class="setting-select" id="difficulty">
                            <option value="beginner">åˆçº§éš¾åº¦</option>
                            <option value="intermediate">ä¸­çº§éš¾åº¦</option>
                            <option value="advanced">é«˜çº§éš¾åº¦</option>
                            <option value="expert">ä¸“å®¶éš¾åº¦</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">è¯­éŸ³é£æ ¼</label>
                        <select class="setting-select" id="voiceStyle">
                            <option value="nova">Nova (å¥³æ€§)</option>
                            <option value="alloy">Alloy (ä¸­æ€§)</option>
                            <option value="echo">Echo (ç”·æ€§)</option>
                            <option value="fable">Fable (è‹±å›½å£éŸ³)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-section">
                <div class="chat-container" id="chatContainer">
                    <div class="message ai">
                        <div class="message-header">
                            ğŸ¤– AIé¢è¯•å®˜ Sarah
                        </div>
                        <div class="message-content" id="welcomeMessage">
                            æ¬¢è¿ä½¿ç”¨PersonaHire Ultimateï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±AIé¢è¯•å®˜Sarahã€‚
                            <br><br>
                            <strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong><br>
                            â€¢ åŸºäºGPT-4.1çš„æ·±åº¦æ¨ç†èƒ½åŠ›<br>
                            â€¢ ElevenLabsçœŸäººçº§è¯­éŸ³åˆæˆ<br>
                            â€¢ ä¸ªæ€§åŒ–é¢è¯•é£æ ¼è°ƒæ•´<br>
                            â€¢ ä¸“ä¸šçš„é¢è¯•è¡¨ç°è¯„ä¼°
                            <br><br>
                            è¯·é…ç½®æ‚¨çš„é¢è¯•åå¥½ï¼Œç„¶åç‚¹å‡»"å¼€å§‹é¢è¯•"ã€‚æˆ‘ä¼šæ ¹æ®æ‚¨çš„è®¾ç½®æä¾›æœ€é€‚åˆçš„é¢è¯•ä½“éªŒã€‚
                        </div>
                        <div class="voice-controls">
                            <button class="voice-btn" onclick="playWelcomeMessage()">ğŸ”Š å¬è¯­éŸ³æ¬¢è¿</button>
                        </div>
                    </div>
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="input-section">
                    <textarea 
                        class="input-textarea" 
                        id="messageInput" 
                        placeholder="è¯·è¾“å…¥æ‚¨çš„å›ç­”..."
                        disabled
                    ></textarea>
                    <button class="send-button" id="sendBtn" disabled>
                        å‘é€å›ç­”
                    </button>
                </div>

                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="controls">
                    <button class="control-btn primary" id="startBtn">
                        å¼€å§‹é¢è¯•
                    </button>
                    <button class="control-btn" id="reportBtn" disabled>
                        ç”ŸæˆæŠ¥å‘Š
                    </button>
                    <button class="control-btn" id="endBtn" disabled>
                        ç»“æŸé¢è¯•
                    </button>
                    <button class="control-btn" id="clearBtn">
                        æ¸…ç©ºå¯¹è¯
                    </button>
                </div>

                <!-- åŠ è½½çŠ¶æ€ -->
                <div class="loading" id="loading">
                    <div class="audio-indicator" id="audioIndicator">ğŸµ æ­£åœ¨ç”Ÿæˆè¯­éŸ³...</div>
                    <div class="loading-spinner"></div>
                    AIé¢è¯•å®˜æ­£åœ¨åˆ†ææ‚¨çš„å›ç­”...
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="debug-info" id="debugInfo">
            <strong>ğŸ” è°ƒè¯•ä¿¡æ¯:</strong>
            <div id="debugContent">ç³»ç»Ÿå¯åŠ¨å®Œæˆ</div>
        </div>

        <!-- åº•éƒ¨é“¾æ¥ -->
        <div class="footer-links">
            <a href="?dev=true" id="devModeLink">
                ğŸ”§ å¼€å‘è€…æ¨¡å¼
            </a>
            <span class="footer-separator">|</span>
            <a href="https://github.com/Kyle-Wang0211/PersonaHire-Ultimate" target="_blank">
                ğŸ’» æŸ¥çœ‹æºç 
            </a>
            <span class="footer-separator">|</span>
            <a href="mailto:wkd20040211@gmail.com">
                ğŸ“§ è”ç³»ä½œè€…
            </a>
            <span class="footer-separator">|</span>
            <a href="#" onclick="toggleDebug()">
                ğŸ› è°ƒè¯•ä¿¡æ¯
            </a>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let openaiKey = '';
        let elevenKey = '';
        let conversationHistory = [];
        let interviewStarted = false;
        let currentAudio = null;
        let lastQuestions = []; // é˜²é‡å¤é—®é¢˜è®°å½•
        
        // æ¨¡å¼æ£€æµ‹
        const isDeveloperMode = window.location.search.includes('dev=true');
        
        // é¢„è®¾APIå¯†é’¥ (è¯·æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†é’¥)
        const DEFAULT_OPENAI_KEY = "your-openai-api-key-here";
        const DEFAULT_ELEVEN_KEY = "your-elevenlabs-api-key-here";

        // é¢è¯•å®˜äººæ ¼åº“
        const INTERVIEWER_PERSONALITIES = {
            professional: `ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æŠ€æœ¯æ€»ç›‘Sarahï¼Œæœ‰15å¹´é¢è¯•ç»éªŒã€‚é¢è¯•é£æ ¼ä¸¥è°¨ã€ä¸“ä¸šï¼Œä¼šæ·±æŒ–æŠ€æœ¯ç»†èŠ‚å’Œé€»è¾‘æ€ç»´èƒ½åŠ›ã€‚æ¯ä¸ªé—®é¢˜éƒ½æœ‰æ˜ç¡®ç›®çš„ï¼Œä¸å…è®¸æ¨¡ç³Šå›ç­”ã€‚ä½ ä¼šæ ¹æ®å€™é€‰äººçš„è¡¨ç°åŠ¨æ€è°ƒæ•´é—®é¢˜éš¾åº¦ã€‚`,
            
            friendly: `ä½ æ˜¯ä¸€ä½æ¸©å’Œçš„HRç»ç†Sarahï¼Œæ“…é•¿è®©ç´§å¼ çš„å€™é€‰äººæ”¾æ¾ã€‚ä½ ä¼šç”¨é¼“åŠ±çš„è¯­æ°”ï¼Œé€‚æ—¶ç»™äºˆæ­£é¢åé¦ˆï¼Œè®©é¢è¯•è€…å‘æŒ¥å‡ºæœ€ä½³çŠ¶æ€ã€‚ä½†åŒæ—¶ä¿æŒä¸“ä¸šæ ‡å‡†ï¼Œç¡®ä¿é¢è¯•è´¨é‡ã€‚`,
            
            pressure: `ä½ æ˜¯ä¸€ä½ä»¥é«˜æ ‡å‡†è‘—ç§°çš„éƒ¨é—¨ä¸»ç®¡Sarahï¼Œä¼šé€šè¿‡æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜æµ‹è¯•å€™é€‰äººçš„æŠ—å‹èƒ½åŠ›å’Œåº”å˜èƒ½åŠ›ã€‚ä½ ä¼šåˆ¶é€ é€‚åº¦å‹åŠ›ï¼Œä½†å§‹ç»ˆä¿æŒä¸“ä¸šå’Œå°Šé‡ã€‚`,
            
            creative: `ä½ æ˜¯ä¸€ä½åˆ›æ–°å¯¼å‘çš„å›¢é˜Ÿé¢†å¯¼Sarahï¼Œå–œæ¬¢å¼€æ”¾å¼é—®é¢˜å’Œåˆ›æ„æ€ç»´ã€‚ä½ ä¼šé¼“åŠ±å€™é€‰äººè·³å‡ºå¸¸è§„æ€è·¯ï¼Œå±•ç¤ºç‹¬ç‰¹è§è§£å’Œåˆ›æ–°èƒ½åŠ›ã€‚`
        };

        const DIFFICULTY_SETTINGS = {
            beginner: "é€‚åˆåº”å±Šç”Ÿå’Œåˆçº§å²—ä½ï¼Œé—®é¢˜ç›¸å¯¹åŸºç¡€ï¼Œé‡ç‚¹è€ƒå¯ŸåŸºæœ¬ç´ è´¨å’Œå­¦ä¹ èƒ½åŠ›",
            intermediate: "é€‚åˆæœ‰1-3å¹´ç»éªŒçš„å€™é€‰äººï¼Œå¹³è¡¡è€ƒå¯Ÿä¸“ä¸šæŠ€èƒ½å’Œè½¯å®åŠ›", 
            advanced: "é€‚åˆèµ„æ·±ä¸“ä¸šäººå£«ï¼Œæ·±åº¦è€ƒå¯Ÿä¸“ä¸šèƒ½åŠ›ã€é¢†å¯¼åŠ›å’Œæˆ˜ç•¥æ€ç»´",
            expert: "é€‚åˆé«˜çº§ç®¡ç†å²—ä½ï¼Œé‡ç‚¹è€ƒå¯Ÿå¤æ‚é—®é¢˜è§£å†³ã€å›¢é˜Ÿç®¡ç†å’Œè¡Œä¸šæ´å¯Ÿ"
        };

        // ç»Ÿä¸€æŒ‰é’®çŠ¶æ€ç®¡ç†å‡½æ•°
        function updateButtonStates(state) {
            try {
                const startBtn = document.getElementById('startBtn');
                const sendBtn = document.getElementById('sendBtn');
                const reportBtn = document.getElementById('reportBtn');
                const endBtn = document.getElementById('endBtn');
                const messageInput = document.getElementById('messageInput');
                const clearBtn = document.getElementById('clearBtn');

                // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!startBtn || !sendBtn || !reportBtn || !endBtn || !messageInput || !clearBtn) {
                    debugLog('æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }

                switch(state) {
                    case 'waiting':
                        startBtn.disabled = false;
                        startBtn.textContent = 'å¼€å§‹é¢è¯•';
                        sendBtn.disabled = true;
                        reportBtn.disabled = true;
                        endBtn.disabled = true;
                        messageInput.disabled = true;
                        clearBtn.disabled = false;
                        break;
                        
                    case 'active':
                        startBtn.disabled = true;
                        startBtn.textContent = 'é¢è¯•è¿›è¡Œä¸­...';
                        sendBtn.disabled = false;
                        reportBtn.disabled = false;
                        endBtn.disabled = false;
                        messageInput.disabled = false;
                        clearBtn.disabled = false;
                        break;
                        
                    case 'ended':
                        startBtn.disabled = false;
                        startBtn.textContent = 'å¼€å§‹é¢è¯•';
                        sendBtn.disabled = true;
                        reportBtn.disabled = false;
                        endBtn.disabled = true;
                        messageInput.disabled = true;
                        clearBtn.disabled = false;
                        break;
                        
                    case 'loading':
                        startBtn.disabled = true;
                        sendBtn.disabled = true;
                        reportBtn.disabled = true;
                        endBtn.disabled = true;
                        clearBtn.disabled = true;
                        break;
                }
                
                debugLog(`æŒ‰é’®çŠ¶æ€æ›´æ–°ä¸º: ${state}`);
            } catch (error) {
                debugLog(`æŒ‰é’®çŠ¶æ€æ›´æ–°å¤±è´¥: ${error.message}`);
            }
        }

        // è°ƒè¯•åŠŸèƒ½
        function debugLog(message) {
            try {
                const debugContent = document.getElementById('debugContent');
                if (debugContent) {
                    const timestamp = new Date().toLocaleTimeString();
                    debugContent.innerHTML += `<br>[${timestamp}] ${message}`;
                    debugContent.scrollTop = debugContent.scrollHeight;
                }
                console.log(`[PersonaHire Debug] ${message}`);
            } catch (error) {
                console.log(`[PersonaHire Debug Error] ${error.message}`);
            }
        }

        function toggleDebug() {
            try {
                const debugInfo = document.getElementById('debugInfo');
                if (debugInfo) {
                    debugInfo.classList.toggle('show');
                }
            } catch (error) {
                debugLog(`è°ƒè¯•é¢æ¿åˆ‡æ¢å¤±è´¥: ${error.message}`);
            }
        }

        // åˆå§‹åŒ–
        function initializeApp() {
            debugLog('åº”ç”¨åˆå§‹åŒ–å¼€å§‹');
            try {
                initializeApiKeys();
                setupEventListeners();
                updateButtonStates('waiting');
                debugLog('åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                debugLog(`åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            try {
                document.getElementById('startBtn').addEventListener('click', startInterview);
                document.getElementById('sendBtn').addEventListener('click', sendMessage);
                document.getElementById('reportBtn').addEventListener('click', generateReport);
                document.getElementById('endBtn').addEventListener('click', endInterview);
                document.getElementById('clearBtn').addEventListener('click', clearChat);
                
                document.getElementById('messageInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                debugLog('äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
            } catch (error) {
                debugLog(`äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å¤±è´¥: ${error.message}`);
            }
        }

        // APIå¯†é’¥åˆå§‹åŒ–
        function initializeApiKeys() {
            try {
                if (isDeveloperMode) {
                    // å¼€å‘è€…æ¨¡å¼
                    document.getElementById('apiSetup').style.display = 'block';
                    document.getElementById('devModeLink').textContent = 'ğŸ‘¤ ç”¨æˆ·æ¨¡å¼';
                    document.getElementById('devModeLink').href = './';
                    document.getElementById('modeIndicator').innerHTML = 'ğŸ”§ å¼€å‘è€…æ¨¡å¼ - å®Œæ•´é…ç½®';
                    document.getElementById('headerStatus').innerHTML = '<span style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></span>ğŸ”§ å¼€å‘è€…æ¨¡å¼';
                    
                    const savedOpenaiKey = localStorage.getItem('openai_api_key');
                    const savedElevenKey = localStorage.getItem('eleven_api_key');
                    
                    if (savedOpenaiKey) {
                        document.getElementById('openaiKey').value = savedOpenaiKey;
                        openaiKey = savedOpenaiKey;
                    }
                    
                    if (savedElevenKey) {
                        document.getElementById('elevenKey').value = savedElevenKey;
                        elevenKey = savedElevenKey;
                    }

                    debugLog('å¼€å‘è€…æ¨¡å¼åˆå§‹åŒ–å®Œæˆ');
                } else {
                    // ç”¨æˆ·æ¨¡å¼
                    document.getElementById('apiSetup').style.display = 'none';
                    openaiKey = DEFAULT_OPENAI_KEY;
                    elevenKey = DEFAULT_ELEVEN_KEY;
                    
                    if (openaiKey && openaiKey !== "your-openai-api-key-here") {
                        debugLog('ç”¨æˆ·æ¨¡å¼ - ä½¿ç”¨é¢„è®¾APIå¯†é’¥');
                    } else {
                        showMessage('âš ï¸ ç³»ç»Ÿæ­£åœ¨ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•æˆ–ä½¿ç”¨å¼€å‘è€…æ¨¡å¼ã€‚', 'error');
                        debugLog('ç”¨æˆ·æ¨¡å¼ - APIå¯†é’¥æœªé…ç½®');
                    }
                }
            } catch (error) {
                debugLog(`APIå¯†é’¥åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        // ä¿å­˜APIå¯†é’¥
        function saveApiKeys() {
            try {
                const openaiInput = document.getElementById('openaiKey');
                const elevenInput = document.getElementById('elevenKey');
                
                openaiKey = openaiInput.value.trim();
                elevenKey = elevenInput.value.trim();
                
                if (openaiKey && openaiKey.startsWith('sk-')) {
                    localStorage.setItem('openai_api_key', openaiKey);
                    if (elevenKey) {
                        localStorage.setItem('eleven_api_key', elevenKey);
                    }
                    showMessage('âœ… APIé…ç½®ä¿å­˜æˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹é¢è¯•äº†ã€‚', 'success');
                    debugLog('APIå¯†é’¥ä¿å­˜æˆåŠŸ');
                } else {
                    showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„OpenAI API Key (ä»¥sk-å¼€å¤´)', 'error');
                    debugLog('APIå¯†é’¥éªŒè¯å¤±è´¥');
                }
            } catch (error) {
                debugLog(`APIå¯†é’¥ä¿å­˜å¤±è´¥: ${error.message}`);
                showMessage('ä¿å­˜APIå¯†é’¥æ—¶å‡ºç°é”™è¯¯', 'error');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showMessage(message, type = 'info') {
            try {
                const statusDiv = document.getElementById('statusMessage');
                if (statusDiv) {
                    statusDiv.className = `status-message ${type}`;
                    statusDiv.innerHTML = message;
                    statusDiv.style.display = 'block';
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                    }, 5000);
                }
            } catch (error) {
                debugLog(`æ˜¾ç¤ºæ¶ˆæ¯å¤±è´¥: ${error.message}`);
            }
        }

        // ç®€å•çš„é‡å¤æ£€æµ‹
        function isQuestionRepeated(question) {
            try {
                // æå–é—®é¢˜çš„å…³é”®è¯
                const keywords = question.toLowerCase().match(/[\u4e00-\u9fa5]+|[a-zA-Z]+/g) || [];
                const questionSignature = keywords.slice(0, 3).join(''); // å–å‰3ä¸ªå…³é”®è¯ä½œä¸ºç­¾å
                
                // æ£€æŸ¥æ˜¯å¦ä¸æœ€è¿‘çš„é—®é¢˜é‡å¤
                const isRepeated = lastQuestions.some(q => {
                    return questionSignature.includes(q) || q.includes(questionSignature);
                });
                
                if (!isRepeated && questionSignature.length > 0) {
                    lastQuestions.push(questionSignature);
                    if (lastQuestions.length > 3) {
                        lastQuestions.shift(); // åªä¿ç•™æœ€è¿‘3ä¸ªé—®é¢˜
                    }
                }
                
                debugLog(`é—®é¢˜é‡å¤æ£€æµ‹: ${isRepeated ? 'é‡å¤' : 'æ–°é—®é¢˜'}`);
                return isRepeated;
            } catch (error) {
                debugLog(`é‡å¤æ£€æµ‹å¤±è´¥: ${error.message}`);
                return false;
            }
        }

        // GPT-4.1 APIè°ƒç”¨
        async function callGPT41(messages) {
            try {
                debugLog(`å‘é€APIè¯·æ±‚ï¼Œæ¶ˆæ¯æ•°é‡: ${messages.length}`);
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openaiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',  // ä½¿ç”¨å¯ç”¨çš„æ¨¡å‹
                        messages: messages,
                        max_tokens: 800,
                        temperature: 0.8,
                        presence_penalty: 0.2,
                        frequency_penalty: 0.1
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'è¯·æ±‚å¤±è´¥');
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                debugLog(`APIå“åº”æˆåŠŸï¼Œé•¿åº¦: ${aiResponse.length}`);
                return aiResponse;
            } catch (error) {
                debugLog(`APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                throw error;
            }
        }

        // è¯­éŸ³åˆæˆ
        async function generateSpeech(text) {
            try {
                debugLog('å¼€å§‹è¯­éŸ³åˆæˆ');
                
                if (!elevenKey || elevenKey === "your-elevenlabs-api-key-here") {
                    // ä½¿ç”¨OpenAI TTSä½œä¸ºå¤‡é€‰
                    try {
                        const response = await fetch('https://api.openai.com/v1/audio/speech', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${openaiKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                model: 'tts-1',
                                voice: document.getElementById('voiceStyle').value,
                                input: text,
                                speed: 1.0
                            })
                        });

                        if (response.ok) {
                            const audioBlob = await response.blob();
                            debugLog('OpenAI TTSåˆæˆæˆåŠŸ');
                            return URL.createObjectURL(audioBlob);
                        }
                    } catch (error) {
                        debugLog(`OpenAI TTSå¤±è´¥: ${error.message}`);
                    }
                    return null;
                }

                // ä½¿ç”¨ElevenLabs TTS
                const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM', {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': elevenKey
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.8,
                            style: 0.3,
                            use_speaker_boost: true
                        }
                    })
                });

                if (response.ok) {
                    const audioBlob = await response.blob();
                    debugLog('ElevenLabs TTSåˆæˆæˆåŠŸ');
                    return URL.createObjectURL(audioBlob);
                }
            } catch (error) {
                debugLog(`è¯­éŸ³åˆæˆå¤±è´¥: ${error.message}`);
            }
            return null;
        }

        // æ’­æ”¾éŸ³é¢‘
        async function playAudio(text) {
            try {
                if (currentAudio) {
                    currentAudio.pause();
                }

                const audioIndicator = document.getElementById('audioIndicator');
                if (audioIndicator) {
                    audioIndicator.style.display = 'block';
                }

                const audioUrl = await generateSpeech(text);
                if (audioUrl) {
                    currentAudio = new Audio(audioUrl);
                    currentAudio.play();
                    
                    currentAudio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        debugLog('éŸ³é¢‘æ’­æ”¾å®Œæˆ');
                    };
                }
            } catch (error) {
                debugLog(`éŸ³é¢‘æ’­æ”¾å¤±è´¥: ${error.message}`);
            } finally {
                const audioIndicator = document.getElementById('audioIndicator');
                if (audioIndicator) {
                    audioIndicator.style.display = 'none';
                }
            }
        }

        // å¼€å§‹é¢è¯•
        async function startInterview() {
            try {
                debugLog('å¼€å§‹é¢è¯•');
                
                // æ£€æŸ¥APIå¯†é’¥
                if (!openaiKey || openaiKey === "your-openai-api-key-here") {
                    showMessage('è¯·å…ˆé…ç½®OpenAI API Key', 'error');
                    return;
                }

                const style = document.getElementById('interviewerStyle').value;
                const difficulty = document.getElementById('difficulty').value;

                // é‡ç½®å†å²è®°å½•
                lastQuestions = [];
                updateButtonStates('loading');
                
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'block';

                const systemPrompt = `${INTERVIEWER_PERSONALITIES[style]}

é¢è¯•éš¾åº¦: ${DIFFICULTY_SETTINGS[difficulty]}

é¢è¯•è§„åˆ™ï¼š
1. ä¸€æ¬¡åªé—®ä¸€ä¸ªé—®é¢˜ï¼Œç­‰å€™é€‰äººå›ç­”å®Œå†é—®ä¸‹ä¸€ä¸ª
2. æ ¹æ®å€™é€‰äººçš„å›ç­”è¿›è¡Œ3-5è½®æ·±åº¦è¿½é—®
3. è®°ä½ä¹‹å‰çš„æ‰€æœ‰å¯¹è¯å†…å®¹ï¼Œå½¢æˆè¿è´¯çš„é¢è¯•ä½“éªŒ
4. æ¯ä¸ªé—®é¢˜éƒ½è¦æœ‰æ˜ç¡®çš„è€ƒå¯Ÿç›®çš„
5. é¢è¯•æ€»æ—¶é•¿æ§åˆ¶åœ¨15-20åˆ†é’Ÿ
6. é€‚æ—¶ç»™äºˆåé¦ˆå’Œé¼“åŠ±
7. æœ€åè¦ç»™å‡ºç»¼åˆè¯„ä»·

è¯·ç”¨ä¸­æ–‡è¿›è¡Œé¢è¯•ï¼Œä¿æŒä¸“ä¸šä½†å‹å¥½çš„è¯­æ°”ã€‚ç°åœ¨å¼€å§‹ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚`;

                conversationHistory = [
                    { role: 'system', content: systemPrompt }
                ];

                const response = await callGPT41(conversationHistory);
                conversationHistory.push({ role: 'assistant', content: response });
                
                addMessage(response, 'ai');
                await playAudio(response);
                
                interviewStarted = true;
                updateButtonStates('active');
                
                debugLog('é¢è¯•å¼€å§‹æˆåŠŸ');
            } catch (error) {
                debugLog(`é¢è¯•å¼€å§‹å¤±è´¥: ${error.message}`);
                showMessage('å¯åŠ¨é¢è¯•å¤±è´¥: ' + error.message, 'error');
                updateButtonStates('waiting');
            } finally {
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'none';
            }
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            try {
                const userInput = document.getElementById('messageInput');
                const message = userInput.value.trim();

                if (!message) return;

                debugLog(`ç”¨æˆ·å‘é€æ¶ˆæ¯: ${message.substring(0, 30)}...`);

                addMessage(message, 'user');
                userInput.value = '';
                
                updateButtonStates('loading');
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'block';

                conversationHistory.push({ role: 'user', content: message });

                const response = await callGPT41(conversationHistory);
                
                // ç®€å•çš„é‡å¤æ£€æµ‹
                if (isQuestionRepeated(response)) {
                    debugLog('æ£€æµ‹åˆ°é‡å¤é—®é¢˜ï¼Œé‡æ–°ç”Ÿæˆ');
                    const retryMessages = [...conversationHistory, {
                        role: 'system',
                        content: 'è¯·æå‡ºä¸€ä¸ªä¸åŒçš„æ–°é—®é¢˜ï¼Œé¿å…é‡å¤ä¹‹å‰çš„å†…å®¹ã€‚'
                    }];
                    const retryResponse = await callGPT41(retryMessages);
                    conversationHistory.push({ role: 'assistant', content: retryResponse });
                    addMessage(retryResponse, 'ai');
                    await playAudio(retryResponse);
                } else {
                    conversationHistory.push({ role: 'assistant', content: response });
                    addMessage(response, 'ai');
                    await playAudio(response);
                }
                
                debugLog('æ¶ˆæ¯å‘é€æˆåŠŸ');
            } catch (error) {
                debugLog(`æ¶ˆæ¯å‘é€å¤±è´¥: ${error.message}`);
                showMessage('å‘é€æ¶ˆæ¯å¤±è´¥: ' + error.message, 'error');
                addMessage('æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åå†è¯•ã€‚', 'ai');
            } finally {
                updateButtonStates('active');
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'none';
            }
        }

        // ç”ŸæˆæŠ¥å‘Š
        async function generateReport() {
            try {
                debugLog('å¼€å§‹ç”Ÿæˆé¢è¯•æŠ¥å‘Š');
                
                if (conversationHistory.length < 4) {
                    showMessage('é¢è¯•å†…å®¹å¤ªå°‘ï¼Œæ— æ³•ç”Ÿæˆæœ‰æ•ˆæŠ¥å‘Šã€‚è¯·è‡³å°‘è¿›è¡Œ3è½®å¯¹è¯ã€‚', 'error');
                    return;
                }

                updateButtonStates('loading');
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'block';

                const reportPrompt = `åŸºäºä»¥ä¸Šå®Œæ•´çš„é¢è¯•å¯¹è¯ï¼Œè¯·ç”Ÿæˆä¸€ä»½ä¸“ä¸šçš„é¢è¯•è¯„ä¼°æŠ¥å‘Šã€‚æŠ¥å‘Šåº”åŒ…æ‹¬ï¼š

1. å€™é€‰äººæ•´ä½“è¡¨ç°æ¦‚è¿°
2. æ ¸å¿ƒèƒ½åŠ›è¯„ä¼°ï¼ˆæŠ€èƒ½ã€æ²Ÿé€šã€é€»è¾‘æ€ç»´ã€åº”å˜èƒ½åŠ›ç­‰ï¼‰
3. å…·ä½“ä¼˜åŠ¿å’Œäº®ç‚¹
4. éœ€è¦æ”¹è¿›çš„æ–¹é¢
5. é¢è¯•è¡¨ç°æ‰“åˆ†ï¼ˆ1-10åˆ†ï¼Œå„ç»´åº¦è¯¦ç»†è¯´æ˜ï¼‰
6. å½•ç”¨å»ºè®®ï¼ˆæ¨è/æœ‰æ¡ä»¶æ¨è/ä¸æ¨èï¼‰
7. é’ˆå¯¹æ€§çš„èŒä¸šå‘å±•å»ºè®®

è¯·ç”¨ä¸“ä¸šã€å®¢è§‚ã€å»ºè®¾æ€§çš„è¯­è¨€æ’°å†™ï¼ŒæŠ¥å‘Šè¦å…·ä½“ã€æœ‰é’ˆå¯¹æ€§ã€‚`;

                const reportHistory = [...conversationHistory, { role: 'user', content: reportPrompt }];
                const report = await callGPT41(reportHistory);
                
                addMessage(`ğŸ“Š **é¢è¯•è¯„ä¼°æŠ¥å‘Š**\n\n${report}`, 'ai');
                await playAudio('æ‚¨çš„ä¸“ä¸šé¢è¯•è¯„ä¼°æŠ¥å‘Šå·²ç»ç”Ÿæˆå®Œæˆï¼Œè¯·æŸ¥çœ‹è¯¦ç»†åˆ†æå’Œå»ºè®®ã€‚');
                
                showMessage('âœ… é¢è¯•æŠ¥å‘Šç”ŸæˆæˆåŠŸï¼', 'success');
                debugLog('é¢è¯•æŠ¥å‘Šç”ŸæˆæˆåŠŸ');
            } catch (error) {
                debugLog(`æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ${error.message}`);
                showMessage('ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ' + error.message, 'error');
            } finally {
                updateButtonStates(interviewStarted ? 'active' : 'ended');
                const loadingDiv = document.getElementById('loading');
                if (loadingDiv) loadingDiv.style.display = 'none';
            }
        }

        // ç»“æŸé¢è¯•
        function endInterview() {
            try {
                debugLog('ç»“æŸé¢è¯•');
                
                interviewStarted = false;
                updateButtonStates('ended');
                
                addMessage('é¢è¯•ç»“æŸï¼Œæ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼å¦‚éœ€æŸ¥çœ‹è¯¦ç»†è¯„ä¼°ï¼Œè¯·ç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"æŒ‰é’®ã€‚', 'ai');
                playAudio('é¢è¯•ç»“æŸï¼Œæ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼');
                
                debugLog('é¢è¯•ç»“æŸæˆåŠŸ');
            } catch (error) {
                debugLog(`ç»“æŸé¢è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // æ¸…ç©ºå¯¹è¯
        function clearChat() {
            try {
                debugLog('æ¸…ç©ºå¯¹è¯');
                
                const chatContainer = document.getElementById('chatContainer');
                if (chatContainer) {
                    chatContainer.innerHTML = `
                        <div class="message ai">
                            <div class="message-header">ğŸ¤– AIé¢è¯•å®˜ Sarah</div>
                            <div class="message-content">
                                æ¬¢è¿ä½¿ç”¨PersonaHire Ultimateï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±AIé¢è¯•å®˜Sarahã€‚è¯·é…ç½®å¥½è®¾ç½®åç‚¹å‡»"å¼€å§‹é¢è¯•"ã€‚
                            </div>
                            <div class="voice-controls">
                                <button class="voice-btn" onclick="playWelcomeMessage()">ğŸ”Š å¬è¯­éŸ³æ¬¢è¿</button>
                            </div>
                        </div>
                    `;
                }
                
                conversationHistory = [];
                lastQuestions = [];
                interviewStarted = false;
                updateButtonStates('waiting');
                
                debugLog('å¯¹è¯æ¸…ç©ºæˆåŠŸ');
            } catch (error) {
                debugLog(`æ¸…ç©ºå¯¹è¯å¤±è´¥: ${error.message}`);
            }
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(content, sender) {
            try {
                const chatContainer = document.getElementById('chatContainer');
                if (!chatContainer) return;
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const senderName = sender === 'ai' ? 'ğŸ¤– AIé¢è¯•å®˜ Sarah' : 'ğŸ‘¤ æ‚¨çš„å›ç­”';
                let messageHTML = `
                    <div class="message-header">${senderName}</div>
                    <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
                `;
                
                if (sender === 'ai') {
                    messageHTML += `
                        <div class="voice-controls">
                            <button class="voice-btn" onclick="playAudio(\`${content.replace(/`/g, '\\`').replace(/'/g, "\\'")}\`)">ğŸ”Š é‡æ’­è¯­éŸ³</button>
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = messageHTML;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                debugLog(`æ·»åŠ æ¶ˆæ¯: ${sender} - ${content.substring(0, 30)}...`);
            } catch (error) {
                debugLog(`æ·»åŠ æ¶ˆæ¯å¤±è´¥: ${error.message}`);
            }
        }

        // æ’­æ”¾æ¬¢è¿æ¶ˆæ¯
        async function playWelcomeMessage() {
            const welcomeText = "æ¬¢è¿æ¥åˆ°PersonaHire Ultimateï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±AIé¢è¯•å®˜Sarahï¼Œæ­è½½äº†æœ€å¼ºå¤§çš„GPT-4.1æ¨ç†å¼•æ“ã€‚è®©æˆ‘ä»¬å¼€å§‹ä¸€åœºç²¾å½©çš„é¢è¯•å§ï¼";
            await playAudio(welcomeText);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>